(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-357438d6"],{"3cce":function(e,t,s){"use strict";var r=s("b050"),i=s.n(r);i.a},"74f0":function(e,t,s){var r={"./en-gb":"39a6","./zh-cn":"5c3a"};function i(e){var t=a(e);return s(t)}function a(e){var t=r[e];if(!(t+1)){var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}return t}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="74f0"},b050:function(e,t,s){},d777:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container app-product-update"},[s("el-page-header",{attrs:{content:"完善商品信息"},on:{back:e.goBack}}),e._v(" "),s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.infoLoading,expression:"infoLoading"}],staticClass:"info-row"},[s("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,size:"medium","label-width":"140px"}},[s("el-form-item",{attrs:{label:"商品编号"}},[e._v("\n                "+e._s(e.product.productCode)+"\n            ")]),e._v(" "),s("el-form-item",{attrs:{label:"商品名称"}},[e._v("\n                "+e._s(e.product.commodityName)+"\n            ")]),e._v(" "),s("el-form-item",{attrs:{prop:"huddle",label:"品种"}},[s("el-radio-group",{attrs:{disabled:2===e.product.status},on:{change:e.changeHuddle},model:{value:e.form.huddle,callback:function(t){e.$set(e.form,"huddle",t)},expression:"form.huddle"}},[s("el-radio",{attrs:{label:1}},[e._v("抱团")]),e._v(" "),s("el-radio",{attrs:{label:0}},[e._v("尚划算")])],1)],1),e._v(" "),s("el-form-item",{attrs:{prop:"supplierSid",label:"所属供应商"}},[s("el-radio-group",{attrs:{disabled:2===e.product.status},model:{value:e.form.supplierSid,callback:function(t){e.$set(e.form,"supplierSid",t)},expression:"form.supplierSid"}},e._l(e.supplierList,function(t){return s("el-radio",{key:t.sid,attrs:{label:t.sid}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),s("el-form-item",{staticClass:"is-required",attrs:{label:"所属分类"}},[s("el-form-item",{staticClass:"fl",attrs:{prop:"firstClassSid"}},[s("el-select",{on:{change:function(t){return e.fetchCategory(1,e.form.firstClassSid)}},model:{value:e.form.firstClassSid,callback:function(t){e.$set(e.form,"firstClassSid",t)},expression:"form.firstClassSid"}},e._l(e.classLevel_0,function(e){return s("el-option",{key:e.sid,attrs:{label:e.className,value:e.sid}})}),1)],1),e._v(" "),s("el-form-item",{staticClass:"fl",attrs:{prop:"secondClassSid"}},[s("el-select",{on:{change:function(t){return e.fetchCategory(2,e.form.secondClassSid)}},model:{value:e.form.secondClassSid,callback:function(t){e.$set(e.form,"secondClassSid",t)},expression:"form.secondClassSid"}},e._l(e.classLevel_1,function(e){return s("el-option",{key:e.sid,attrs:{label:e.className,value:e.sid}})}),1)],1)],1),e._v(" "),s("el-form-item",{attrs:{prop:"clubs",label:"所属俱乐部"}},[s("el-checkbox-group",{attrs:{disabled:2===e.product.status},model:{value:e.form.clubs,callback:function(t){e.$set(e.form,"clubs",t)},expression:"form.clubs"}},[e._l(e.form.clubAttrList,function(t){return[0!==t.sid?s("el-checkbox",{key:t.sid,attrs:{label:t.sid}},[e._v(e._s(t.name))]):e._e()]})],2)],1),e._v(" "),s("el-form-item",[s("div",{staticClass:"app-table",staticStyle:{width:"970px"}},[s("el-table",{attrs:{data:e.form.clubAttrList}},[s("el-table-column",{attrs:{label:"俱乐部",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:[{"is-checked":e.isCheckedClub(t.row)}]},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"最小起订数(件)",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-form-item",{attrs:{prop:"clubAttrList."+t.$index+".minNum",rules:[{required:e.isCheckedClub(t.row),message:"请输入",trigger:"blur"}]}},[s("el-input",{attrs:{type:"number",size:"small",disabled:2===e.product.status},model:{value:e.form.clubAttrList[t.$index].minNum,callback:function(s){e.$set(e.form.clubAttrList[t.$index],"minNum",s)},expression:"form.clubAttrList[scope.$index].minNum"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"最大购买数/人(件)",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-form-item",{attrs:{prop:"clubAttrList."+t.$index+".maxNum",rules:[{required:e.isCheckedClub(t.row),message:"请输入",trigger:"blur"}]}},[s("el-input",{attrs:{type:"number",size:"small",disabled:2===e.product.status},model:{value:e.form.clubAttrList[t.$index].maxNum,callback:function(s){e.$set(e.form.clubAttrList[t.$index],"maxNum",s)},expression:"form.clubAttrList[scope.$index].maxNum"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"倍增数",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-form-item",{attrs:{prop:"clubAttrList."+t.$index+".step",rules:[{required:e.isCheckedClub(t.row),message:"请输入",trigger:"blur"}]}},[s("el-input",{attrs:{type:"number",size:"small",disabled:2===e.product.status},model:{value:e.form.clubAttrList[t.$index].step,callback:function(s){e.$set(e.form.clubAttrList[t.$index],"step",s)},expression:"form.clubAttrList[scope.$index].step"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"新品时间范围",width:"420"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-form-item",{attrs:{prop:"clubAttrList."+t.$index+".date",rules:[{required:!1,type:"array",message:"请输入",trigger:"change"}]}},[s("el-date-picker",{attrs:{type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small",disabled:2===e.product.status},model:{value:e.form.clubAttrList[t.$index].date,callback:function(s){e.$set(e.form.clubAttrList[t.$index],"date",s)},expression:"form.clubAttrList[scope.$index].date"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"热销指数"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-form-item",{attrs:{prop:"clubAttrList."+t.$index+".hotSell",rules:[{required:e.isCheckedClub(t.row),message:"请输入",trigger:"blur"}]}},[s("el-input",{attrs:{type:"number",size:"small",disabled:2===e.product.status},model:{value:e.form.clubAttrList[t.$index].hotSell,callback:function(s){e.$set(e.form.clubAttrList[t.$index],"hotSell",s)},expression:"form.clubAttrList[scope.$index].hotSell"}})],1)]}}])})],1)],1)]),e._v(" "),s("el-form-item",{attrs:{prop:"medicalInsuranceSid",label:"医保类型"}},[s("el-radio-group",{model:{value:e.form.medicalInsuranceSid,callback:function(t){e.$set(e.form,"medicalInsuranceSid",t)},expression:"form.medicalInsuranceSid"}},e._l(e.medicalInsuranceList,function(t){return s("el-radio",{key:t.sid,attrs:{label:t.sid,name:"medicalInsuranceSid"}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),s("el-form-item",{attrs:{prop:"medicalInsuranceArea",label:"医保范围"}},[s("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入医保范围，如湖南省、湖北省"},model:{value:e.form.medicalInsuranceArea,callback:function(t){e.$set(e.form,"medicalInsuranceArea",t)},expression:"form.medicalInsuranceArea"}})],1),e._v(" "),s("el-form-item",{attrs:{prop:"firstSellPoint",label:"一句话卖点1"}},[s("el-input",{attrs:{type:"text",placeholder:"请输入一句话卖点"},model:{value:e.form.firstSellPoint,callback:function(t){e.$set(e.form,"firstSellPoint",t)},expression:"form.firstSellPoint"}})],1),e._v(" "),s("el-form-item",{attrs:{prop:"secondSellPoint",label:"一句话卖点2"}},[s("el-input",{attrs:{type:"text",placeholder:"请输入一句话卖点"},model:{value:e.form.secondSellPoint,callback:function(t){e.$set(e.form,"secondSellPoint",t)},expression:"form.secondSellPoint"}})],1),e._v(" "),s("el-form-item",{attrs:{prop:"fileList",label:"商品图片"}},[e._l(e.form.fileList,function(t,r){return s("div",{key:r,staticClass:"image-list-item"},[s("div",{staticClass:"resource-card resource-card-bordered resource-card-hoverable"},[s("i",{staticClass:"btn-delete el-icon-error",on:{click:function(s){return e.handleRemove(t,r)}}}),e._v(" "),s("div",{staticClass:"resource-card-cover"},["ready"===t.status?s("el-progress",{attrs:{percentage:t.progress,type:"circle"}}):e._e(),e._v(" "),s("img",{directives:[{name:"viewer",rawName:"v-viewer"}],attrs:{alt:t.name,src:1===t.source?e.ossURL+t.url:t.url}})],1),e._v(" "),s("div",{staticClass:"radio-box"},[s("el-radio",{attrs:{label:r,disabled:"success"!==t.status,name:"imageMain"},model:{value:e.form.imageMain,callback:function(t){e.$set(e.form,"imageMain",t)},expression:"form.imageMain"}},[e._v("设为主图")])],1)])])}),e._v(" "),s("el-upload",{ref:"upload",attrs:{action:e.baseURL+"/public/api/file/upload",headers:e.headers,accept:"image/*","file-list":e.form.fileList,"show-file-list":!1,"on-change":e.handleChange,"on-success":e.handleSuccess,"auto-upload":!0}},[s("i",{staticClass:"el-icon-plus"})])],2),e._v(" "),s("el-form-item",{attrs:{prop:"content"}},[s("tinymce",{ref:"tinymce",attrs:{id:"tinymce",height:800},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),e._v(" "),s("el-form-item",[s("el-button",{on:{click:e.goBack}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.save}},[e._v("保 存")])],1)],1)],1)],1)},i=[],a=(s("ac6a"),s("db72")),l=s("2f62"),o=s("b775"),n=s("700d");function c(e){return Object(o["a"])({baseURL:n["a"],url:"/product/admin/product/updatePage/".concat(e.sid),method:"get",params:e})}function u(e){return Object(o["a"])({baseURL:n["a"],url:"/product/admin/productClass/industryClass/simpleList",method:"get",params:e})}function d(e){return Object(o["a"])({baseURL:n["a"],url:"/product/admin/product",method:"put",data:e})}var m=s("8256"),f=s("c1df"),p=s.n(f),b={name:"PageProductForm",components:{Tinymce:m["a"]},data:function(){return{form:{sid:this.$route.query.id,huddle:0,supplierSid:"",firstClassSid:"",secondClassSid:"",clubs:[],minNum:"",maxNum:"",step:"",imageMain:0,clubAttrList:[],fileList:[],medicalInsuranceSid:"",medicalInsuranceArea:"",firstSellPoint:"",secondSellPoint:"",content:""},rules:{huddle:[{required:!0,message:"请选择品种",trigger:"change"}],supplierSid:[{required:!0,message:"请选择所属供应商",trigger:"change"}],firstClassSid:[{required:!0,message:"请选择一级分类",trigger:"change"}],secondClassSid:[{required:!0,message:"请选择二级分类",trigger:"change"}],minNum:[{required:!0,message:"请输入最小起订数",trigger:"change"}],maxNum:[{required:!0,message:"请输入最大购买数",trigger:"change"}],step:[{required:!0,message:"请输入倍增数",trigger:"change"}],medicalInsuranceSid:[{required:!0,message:"请选择医保类型",trigger:"change"}],fileList:[{required:!0,type:"array",message:"请上传商品图片",trigger:"change"}],content:[]},clubList:[],medicalInsuranceList:[],product:{},skuList:[],supplierList:[],classLevel_0:[],classLevel_1:[],classLevel_2:[],baseURL:n["a"],ossURL:this.$store.getters.oss_url+"/",headers:{Authorization:"Bearer "+this.$store.getters.access_token},loading:!1,infoLoading:!1}},computed:Object(a["a"])({},Object(l["b"])(["permissions"]),{height:function(){return this.$store.getters.winHeight-390}}),created:function(){this.prdouctDetail()},methods:{goBack:function(){this.$store.dispatch("tagsView/delView",this.$route),this.$router.go(-1)},prdouctDetail:function(){var e=this;this.infoLoading=!0,c({sid:this.form.sid}).then(function(t){var s=t.data.data;for(var r in 0===s.clubList[0].sid&&s.clubList.splice(0,1),e.form.clubAttrList=s.clubList,e.medicalInsuranceList=s.medicalInsuranceList,e.product=s.product,e.skuList=s.skuList,e.supplierList=s.supplierList,e.form)null!==e.product[r]&&void 0!==e.product[r]&&(e.form[r]=e.product[r]);e.product.imgList.forEach(function(t,s){e.form.fileList.push({url:t.imgUrl,source:1}),1===t.main&&(e.form.imageMain=s)}),e.form.clubAttrList.forEach(function(t){var s=e.product.businessAttrList.filter(function(e){return e.club===t.sid});1===s.length?(e.$set(t,"minNum",s[0].minNum),e.$set(t,"maxNum",s[0].maxNum),e.$set(t,"step",s[0].step),e.$set(t,"hotSell",s[0].hotSell||0),s[0].newStartTime&&s[0].newEndTime&&e.$set(t,"date",[s[0].newStartTime,s[0].newEndTime]),0===s[0].remove&&e.form.clubs.push(t.sid)):(e.$set(t,"minNum",""),e.$set(t,"maxNum",""),e.$set(t,"step",""),e.$set(t,"date",[]),e.$set(t,"hotSell",0))}),e.infoLoading=!1,e.$nextTick(function(){e.fetchCategory(0,0,"edit"),e.form.firstClassSid&&e.fetchCategory(1,e.form.firstClassSid,"edit"),e.form.secondClassSid&&e.fetchCategory(2,e.form.secondClassSid,"edit"),e.$refs["tinymce"].setContent(e.product.content)})}).catch(function(){e.infoLoading=!1})},fetchCategory:function(e,t,s){var r=this;1!==e||s||(this.form.secondClassSid=""),u({parentSid:t,huddle:this.form.huddle}).then(function(t){var s=t.data;r["classLevel_"+e]=s.data.records||[]})},changeHuddle:function(){this.form.firstClassSid="",this.form.secondClassSid="",this.fetchCategory(0,0)},isCheckedClub:function(e){return 1===this.form.clubs.filter(function(t){return t===e.sid}).length},handleChange:function(e,t){e.url=URL.createObjectURL(e.raw),this.form.fileList=t},handleSuccess:function(e,t){this.$message.success("上传成功")},handleRemove:function(e,t){this.form.fileList.splice(t,1)},save:function(){var e=this;this.$refs["ruleForm"].validate(function(t){if(!t)return!1;var s=Object.assign({},e.form);s.imgList=[],s.fileList.forEach(function(t,r){"success"===t.status&&(t.response&&0===t.response.code?s.imgList.push({url:t.response.data[0],main:r===e.form.imageMain?1:0}):s.imgList.push({url:t.url,main:r===e.form.imageMain?1:0}))}),s.clubAttrList.forEach(function(t){t.remove=!0===e.isCheckedClub(t)?0:1,t.club=t.sid,t.date&&t.date.length>0&&(t.newStartTime=p()(t.date[0]).format("YYYY-MM-DD HH:mm:ss"),t.newEndTime=p()(t.date[1]).format("YYYY-MM-DD HH:mm:ss"))}),delete s.fileList,delete s.clubs,delete s.imageMain,e.saveAction(s)})},saveAction:function(e){var t=this;this.loading=!0,d(e).then(function(){t.goBack(),t.loading=!1,t.$notify({title:"成功",message:"完善商品信息成功",type:"success",duration:2e3})}).catch(function(){t.loading=!1})}}},g=b,h=(s("3cce"),s("2877")),v=Object(h["a"])(g,r,i,!1,null,null,null);t["default"]=v.exports}}]);