(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1c05489a"],{1943:function(e,t,a){"use strict";var n=a("abbe"),r=a.n(n);r.a},"58c3":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"app-search-bar clearfix"},[a("div",{staticClass:"app-search-right"},[a("el-button",{staticClass:"filter-item",attrs:{size:"small",type:"primary",icon:"el-icon-edit"},on:{click:e.create}},[e._v("添加")])],1)]),e._v(" "),a("div",{staticClass:"app-table"},[a("el-table",{attrs:{data:e.tableData,height:e.height}},[a("el-table-column",{attrs:{prop:"roleName",label:"角色名称","min-width":"150",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"roleCode",label:"角色标识","min-width":"150",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"roleDesc",label:"角色描述","min-width":"150",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dsType",label:"数据权限","min-width":"150",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间","min-width":"150",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right","min-width":"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.update(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.remove(t.row)}}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-lock"},on:{click:function(a){return e.updatePermession(t.row)}}},[e._v("权限")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"app-pagination"},[a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","prev-text":"上一页","next-text":"下一页","page-sizes":[20,50,100,200],"current-page":e.page.currentPage,"page-size":e.page.pageSize,total:e.page.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}})],1),e._v(" "),a("win-role",{ref:"refRole"}),e._v(" "),a("win-permession",{ref:"refPermession"})],1)},r=[],o=a("b775"),i=a("700d");function l(e){return Object(o["a"])({baseURL:i["a"],url:"/admin/role/page",method:"get",params:e})}function s(e){return Object(o["a"])({baseURL:i["a"],url:"/admin/role",method:"post",data:e})}function c(e){return Object(o["a"])({baseURL:i["a"],url:"/admin/role",method:"put",data:e})}function u(e){return Object(o["a"])({baseURL:i["a"],url:"/admin/role/"+e,method:"delete"})}function d(e,t){return Object(o["a"])({baseURL:i["a"],url:"/admin/role/menu",method:"put",params:{roleId:e,menuIds:t}})}function f(e){return Object(o["a"])({baseURL:i["a"],url:"/admin/menu/tree/"+e,method:"get"})}var m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-win-auth-role",attrs:{title:e.edit?"编 辑":"新 增",visible:e.show,"close-on-click-modal":!1},on:{"update:visible":function(t){e.show=t}}},[a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,size:"medium","label-width":"96px"}},[a("el-form-item",{attrs:{prop:"roleName",label:"角色名称："}},[a("el-input",{attrs:{maxlength:20,placeholder:"请输入角色名称"},model:{value:e.form.roleName,callback:function(t){e.$set(e.form,"roleName",t)},expression:"form.roleName"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"roleCode",label:"角色标识："}},[a("el-input",{attrs:{maxlength:20,placeholder:"请输入角色标识"},model:{value:e.form.roleCode,callback:function(t){e.$set(e.form,"roleCode",t)},expression:"form.roleCode"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"roleDesc",label:"角色描述："}},[a("el-input",{attrs:{maxlength:20,placeholder:"请输入角色描述"},model:{value:e.form.roleDesc,callback:function(t){e.$set(e.form,"roleDesc",t)},expression:"form.roleDesc"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"dsType",label:"数据权限："}},[a("el-select",{attrs:{placeholder:"请选数据权限"},model:{value:e.form.dsType,callback:function(t){e.$set(e.form,"dsType",t)},expression:"form.dsType"}},e._l(e.dicData,function(e){return a("el-option",{key:e.detailValue,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),1==e.form.dsType?a("el-form-item",{attrs:{label:"自定义权限："}},[a("el-tree",{ref:"scopeTree",staticClass:"filter-tree",attrs:{data:e.dsScopeData,"check-strictly":!0,"node-key":"id","highlight-current":"",props:e.defaultProps,"default-checked-keys":e.checkedDsScope,"show-checkbox":""}})],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.show=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.save}},[e._v("确 定")])],1)],1)},h=[],p=(a("28a5"),a("a0ac")),g={name:"WinRole",components:{},data:function(){return{edit:!1,loading:!1,form:{roleName:"",roleCode:"",roleDesc:"",dsType:0},rules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色标识",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],roleDesc:[{required:!0,message:"请输入角色描述",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],dsType:[{required:!0,message:"请输入数据权限类型",trigger:"blur"}]},defaultProps:{label:"name",value:"id"},dicData:[{label:"全部",value:0},{label:"自定义",value:1},{label:"本级及子级",value:2},{label:"本级",value:3}],checkedDsScope:[],show:!1}},watch:{},created:function(){},methods:{add:function(e){var t=this;this.edit=!1,this.loading=!1,this.callback=e,this.checkedDsScope=[],this.handleOpenBefore(function(){t.show=!0,t.$nextTick(function(){t.$refs["ruleForm"].resetFields()})})},update:function(e,t){var a=this;this.edit=!0,this.loading=!1,this.callback=t,this.checkedDsScope=[],this.handleOpenBefore(function(){a.show=!0,a.$nextTick(function(){for(var t in a.$refs["ruleForm"].resetFields(),a.form)e[t]&&(a.form[t]=e[t]);e.dsScope?a.checkedDsScope=e.dsScope.split(","):a.checkedDsScope=[]})})},save:function(){var e=this;this.$refs["ruleForm"].validate(function(t){if(!t)return!1;e.loading=!0;var a=Object.assign({},e.form);1===e.form.dsType&&(a.dsScope=e.$refs.scopeTree.getCheckedKeys().join(",")),e.callback(a)})},close:function(){this.show=!1},handleOpenBefore:function(e){var t=this;Object(p["c"])().then(function(a){t.dsScopeData=a.data.data,e()})}}},b=g,v=(a("c5a6"),a("2877")),k=Object(v["a"])(b,m,h,!1,null,null,null),y=k.exports,w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-win-auth-permession",attrs:{title:"编辑权限",visible:e.show,"close-on-click-modal":!1},on:{"update:visible":function(t){e.show=t}}},[a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,size:"medium","label-width":"0px"}},[a("el-form-item",[a("el-tree",{ref:"menuTree",staticClass:"filter-tree",attrs:{data:e.treeData,"default-checked-keys":e.checkedKeys,"check-strictly":!1,"node-key":"id","highlight-current":"",props:e.defaultProps,"show-checkbox":"","filter-node-method":e.filterNode,"default-expand-all":""}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.show=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.save}},[e._v("确 定")])],1)],1)},_=[],$=a("a308"),x={name:"WinPermession",components:{},data:function(){return{edit:!1,loading:!1,form:{menuIds:""},rules:{},defaultProps:{label:"name",value:"id"},treeData:[],checkedKeys:[],show:!1}},watch:{},created:function(){},methods:{update:function(e,t){var a=this;this.edit=!0,this.loading=!1,this.callback=t,this.checkedKeys=[],this.handlePermission(e,function(){a.show=!0,a.$nextTick(function(){a.$refs["ruleForm"].resetFields()})})},save:function(){var e=this;this.$refs["ruleForm"].validate(function(t){if(!t)return!1;e.loading=!0;var a=Object.assign({},e.form);a.menuIds=e.$refs.menuTree.getCheckedKeys().join(",").concat(",").concat(e.$refs.menuTree.getHalfCheckedKeys().join(",")),e.callback(a)})},close:function(){this.show=!1},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},handlePermission:function(e,t){var a=this;f(e.roleId).then(function(e){return a.checkedKeys=e.data.data,Object($["c"])()}).then(function(n){a.treeData=n.data.data,a.checkedKeys=a.resolveAllEunuchNodeId(a.treeData,a.checkedKeys,[]),a.roleId=e.roleId,a.roleCode=e.roleCode,t()})},resolveAllEunuchNodeId:function(e,t,a){for(var n=this,r=function(r){var o=e[r];o.children&&0!==o.children.length?n.resolveAllEunuchNodeId(o.children,t,a):a.push(t.filter(function(e){return e===o.id}))},o=0;o<e.length;o++)r(o);return a}}},C=x,j=(a("1943"),Object(v["a"])(C,w,_,!1,null,null,null)),O=j.exports,R={name:"PageAuthRole",components:{WinRole:y,WinPermession:O},data:function(){return{tableData:[],page:{total:0,currentPage:1,pageSize:20}}},computed:{height:function(){return this.$store.getters.winHeight-205}},created:function(){this.query()},methods:{query:function(){var e=this;this.listLoading=!0,l(Object.assign({current:this.page.currentPage,size:this.page.pageSize},this.searchParams)).then(function(t){e.tableData=t.data.data.records,e.page.total=t.data.data.total,e.listLoading=!1})},sizeChange:function(e){this.page.pageSize=e,this.query()},pageChange:function(e){this.page.currentPage=e,this.query()},create:function(){var e=this;this.$refs["refRole"].add(function(t){s(t).then(function(){e.$refs["refRole"].loading=!1,e.query(),e.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})}).catch(function(){e.$refs["refRole"].loading=!1})})},remove:function(e){var t=this;this.$confirm('是否确认删除名称为"'+e.roleName+'"的数据项?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return u(e.roleId)}).then(function(){t.query(),t.$message({showClose:!0,message:"删除成功",type:"success"})}).catch(function(){})},update:function(e){var t=this;this.$refs["refRole"].update(e,function(e){c(e).then(function(){t.query(),t.$refs["refRole"].loading=!1,t.$refs["refRole"].close(),t.$notify({title:"成功",message:"修改成功",type:"success",duration:2e3})}).catch(function(){t.$refs["refRole"].loading=!1})})},updatePermession:function(e){var t=this;this.$refs["refPermession"].update(e,function(a){d(e.roleId,a.menuIds).then(function(){t.$refs["refPermession"].loading=!1,t.$refs["refPermession"].close(),t.$notify({title:"成功",message:"修改成功",type:"success",duration:2e3})}).catch(function(){t.$refs["refPermession"].loading=!1})})}}},D=R,P=Object(v["a"])(D,n,r,!1,null,null,null);t["default"]=P.exports},a0ac:function(e,t,a){"use strict";a.d(t,"c",function(){return o}),a.d(t,"a",function(){return i}),a.d(t,"d",function(){return l}),a.d(t,"b",function(){return s}),a.d(t,"e",function(){return c});var n=a("b775"),r=a("700d");function o(e){return Object(n["a"])({baseURL:r["a"],url:"/admin/dept/tree",method:"get",params:e})}function i(e){return Object(n["a"])({baseURL:r["a"],url:"/admin/dept/",method:"post",data:e})}function l(e){return Object(n["a"])({baseURL:r["a"],url:"/admin/dept/"+e,method:"get"})}function s(e){return Object(n["a"])({baseURL:r["a"],url:"/admin/dept/"+e,method:"delete"})}function c(e){return Object(n["a"])({baseURL:r["a"],url:"/admin/dept/",method:"put",data:e})}},a308:function(e,t,a){"use strict";a.d(t,"c",function(){return o}),a.d(t,"a",function(){return i}),a.d(t,"d",function(){return l}),a.d(t,"b",function(){return s}),a.d(t,"e",function(){return c});var n=a("b775"),r=a("700d");function o(e){return Object(n["a"])({baseURL:r["a"],url:"/admin/menu/tree",method:"get",params:e})}function i(e){return Object(n["a"])({baseURL:r["a"],url:"/admin/menu",method:"post",data:e})}function l(e){return Object(n["a"])({baseURL:r["a"],url:"/admin/menu/"+e,method:"get"})}function s(e){return Object(n["a"])({baseURL:r["a"],url:"/admin/menu/"+e,method:"delete"})}function c(e){return Object(n["a"])({baseURL:r["a"],url:"/admin/menu",method:"put",data:e})}},abbe:function(e,t,a){},c5a6:function(e,t,a){"use strict";var n=a("e7d5"),r=a.n(n);r.a},e7d5:function(e,t,a){}}]);