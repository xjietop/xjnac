(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60ea672d"],{"0cc7":function(t,e,a){},"183d":function(t,e,a){"use strict";var n=a("d9ef"),r=a.n(n);r.a},"386d":function(t,e,a){"use strict";var n=a("cb7c"),r=a("83a1"),i=a("5f1b");a("214f")("search",1,function(t,e,a,o){return[function(a){var n=t(this),r=void 0==a?void 0:a[e];return void 0!==r?r.call(a,n):new RegExp(a)[e](String(n))},function(t){var e=o(a,t,this);if(e.done)return e.value;var s=n(t),c=String(this),l=s.lastIndex;r(l,0)||(s.lastIndex=0);var u=i(s,c);return r(s.lastIndex,l)||(s.lastIndex=l),null===u?-1:u.index}]})},"83a1":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},a839:function(t,e,a){"use strict";a.d(e,"c",function(){return i}),a.d(e,"a",function(){return o}),a.d(e,"d",function(){return s}),a.d(e,"b",function(){return c}),a.d(e,"g",function(){return l}),a.d(e,"h",function(){return u}),a.d(e,"f",function(){return f}),a.d(e,"e",function(){return d});var n=a("b775"),r=a("700d");function i(t){return Object(n["a"])({baseURL:r["a"],url:"/marketing/admin/marketing/page",method:"get",params:t})}function o(t){return Object(n["a"])({baseURL:r["a"],url:"/marketing/admin/marketing",method:"post",data:t})}function s(t){return Object(n["a"])({baseURL:r["a"],url:"/marketing/admin/marketing/info/".concat(t),method:"get"})}function c(t){return Object(n["a"])({baseURL:r["a"],url:"/marketing/admin/marketing/".concat(t.actId),method:"delete"})}function l(t){return Object(n["a"])({baseURL:r["a"],url:"/marketing/admin/marketing",method:"put",data:t})}function u(t){return Object(n["a"])({baseURL:r["a"],url:"/marketing/admin/marketing/".concat(t.actId,"/").concat(t.status),method:"get"})}function f(t){return Object(n["a"])({baseURL:r["a"],url:"/marketing/admin/marketing/audit",method:"get",params:t})}function d(t){return Object(n["a"])({baseURL:r["a"],url:"/marketing/admin/marketing/copy/".concat(t.actId),method:"get",params:t})}},ab31:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container app-market-promotion"},[a("search-bar",{ref:"refSearch",attrs:{"search-data":t.searchData,"auto-load":!0},on:{search:t.query}},[a("template",{slot:"right"},[a("div",{staticClass:"app-search-right"},[a("el-button",{staticClass:"filter-item",attrs:{size:"small",type:"primary",icon:"el-icon-edit"},on:{click:t.create}},[t._v("添加")])],1)])],2),t._v(" "),a("div",{staticClass:"app-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],ref:"refTable",attrs:{data:t.tableData,height:t.height,stripe:"","tooltip-effect":"light"}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"50",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"促销名称","min-width":"180",align:"center","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"link",on:{click:function(a){return t.viewDetail(e.row)}}},[t._v(t._s(e.row.name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"clubName",label:"俱乐部","min-width":"80",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间","min-width":"150",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"createUser",label:"创建人","min-width":"120",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"startTime",label:"促销开始时间","min-width":"150",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"endTime",label:"促销结束时间","min-width":"150",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"typeName",label:"促销类型","min-width":"120",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"statusName",label:"状态","min-width":"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return["审核不通过"===e.row.statusName&&e.row.description.length>0?[t._v("\n                        "+t._s(e.row.statusName)+" \n                        "),a("el-popover",{attrs:{placement:"top-start",title:"原因",width:"200",trigger:"hover",content:e.row.description}},[a("i",{staticClass:"el-icon-question",attrs:{slot:"reference"},slot:"reference"})])]:[t._v("\n                        "+t._s(e.row.statusName)+"\n                    ")]]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right","min-width":"280",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",disabled:"草稿"!==e.row.statusName&&"审核不通过"!==e.row.statusName},on:{click:function(a){return t.update(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.copy(e.row)}}},[t._v("复制")]),t._v(" "),a("el-button",{attrs:{type:"text",disabled:"草稿"!==e.row.statusName},on:{click:function(a){return t.submit(e.row)}}},[t._v("提交审核")]),t._v(" "),a("el-button",{attrs:{type:"text",disabled:"待审核"!==e.row.statusName},on:{click:function(a){return t.audit(e.row)}}},[t._v("审核")]),t._v(" "),a("el-button",{attrs:{type:"text",disabled:"待生效"!==e.row.statusName&&"促销中"!==e.row.statusName},on:{click:function(a){return t.cancel(e.row)}}},[t._v("作废")]),t._v(" "),a("el-button",{attrs:{type:"text",disabled:"已作废"!==e.row.statusName&&"草稿"!==e.row.statusName},on:{click:function(a){return t.remove(e.row)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),a("div",{staticClass:"app-pagination"},[a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","prev-text":"上一页","next-text":"下一页","page-sizes":[20,50,100,200],"current-page":t.searchData.page.current,"page-size":t.searchData.page.size,total:t.page.total},on:{"size-change":t.sizeChange,"current-change":t.pageChange}})],1),t._v(" "),a("win-audit",{ref:"refAudit"})],1)},r=[],i=(a("7f7f"),a("386d"),a("db72")),o=a("a839"),s=a("5880"),c=a("b932"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"el-win-market-promotion-audit",attrs:{title:"审核",visible:t.show,"close-on-click-modal":!1},on:{"update:visible":function(e){t.show=e}}},[a("el-form",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,size:"medium","label-width":"0px"}},[a("el-form-item",{attrs:{prop:"flag"}},[a("el-radio",{attrs:{label:1},model:{value:t.form.flag,callback:function(e){t.$set(t.form,"flag",e)},expression:"form.flag"}},[t._v("通过")]),t._v(" "),a("el-radio",{attrs:{label:0},model:{value:t.form.flag,callback:function(e){t.$set(t.form,"flag",e)},expression:"form.flag"}},[t._v("不通过")])],1),t._v(" "),0===t.form.flag?a("el-form-item",[a("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入不通过原因"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1):t._e()],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.show=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.save}},[t._v("确 定")])],1)],1)},u=[],f={name:"WinMarketPromotionAudit",data:function(){return{edit:!1,loading:!1,form:{flag:1,description:""},rules:{flag:[],description:[]},show:!1}},watch:{},created:function(){},methods:{update:function(t,e){var a=this;this.edit=!0,this.loading=!1,this.callback=e,this.show=!0,this.$nextTick(function(){a.$refs["ruleForm"].resetFields(),a.form.flag=1,a.form.actId=t.sid})},save:function(){var t=this;this.$refs["ruleForm"].validate(function(e){if(!e)return!1;t.loading=!0;var a=Object.assign({},t.form);t.callback(a)})},close:function(){this.show=!1}}},d=f,m=(a("e372"),a("2877")),p=Object(m["a"])(d,l,u,!1,null,null,null),h=p.exports,b={name:"PageMarketPromotion",components:{searchBar:c["a"],winAudit:h},data:function(){return{searchData:{quickList:[{label:"按促销名称",value:"name"},{label:"按创建人",value:"createUser"}],searchList:[{prop:"club",placeholder:"展示俱乐部",type:"select",clearable:!0,list:[{label:"乐赛仙",value:1},{label:"佐安堂",value:2},{label:"初心",value:3},{label:"尚划算",value:4}]},{prop:"type",placeholder:"活动类型",type:"select",clearable:!0,list:[{label:"单品满数量赠",value:1},{label:"购套餐送赠品",value:2},{label:"购套餐减金额",value:4},{label:"组合满金额赠",value:6},{label:"第一次下单送赠品",value:7},{label:"组合满数量赠",value:8}]},{prop:"status",placeholder:"活动状态",type:"select",clearable:!0,list:[{label:"草稿",value:0},{label:"待审核",value:1},{label:"待生效",value:2},{label:"促销中",value:3},{label:"已作废",value:4}]}],page:{size:20,current:1}},tableData:[],tableLoading:!1,page:{total:0}}},computed:Object(i["a"])({},Object(s["mapGetters"])(["permissions"]),{height:function(){return this.$store.getters.winHeight-205}}),activated:function(){this.$refs["refTable"].doLayout()},methods:{query:function(t){var e=this;this.tableLoading=!0,Object(o["c"])(Object.assign({},t)).then(function(t){e.tableData=t.data.data.records,e.page.total=t.data.data.total,e.tableLoading=!1})},sizeChange:function(t){this.$refs["refSearch"].search({size:t})},pageChange:function(t){this.$refs["refSearch"].search({current:t})},viewDetail:function(t){this.$router.push({path:"/market/promotion/view",query:{id:t.sid}})},create:function(){this.$router.push({path:"/market/promotion/creat"})},remove:function(t){var e=this;this.$confirm('是否确认删除名称为"'+t.name+'"的活动吗?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return Object(o["b"])({actId:t.sid})}).then(function(){e.$refs["refSearch"].search({current:e.searchData.page.current}),e.$message({showClose:!0,message:"删除成功",type:"success"})}).catch(function(){})},submit:function(t){var e=this;this.$confirm('是否确认提交名称为"'+t.name+'"的活动吗?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return Object(o["h"])({actId:t.sid,status:1})}).then(function(){e.$refs["refSearch"].search({current:e.searchData.page.current}),e.$message({showClose:!0,message:"提交审核成功",type:"success"})}).catch(function(){})},audit:function(t){var e=this;this.$refs["refAudit"].update(t,function(t){Object(o["f"])(t).then(function(){e.$refs["refAudit"].loading=!1,e.$refs["refAudit"].close(),e.$refs["refSearch"].search({current:e.searchData.page.current}),e.$notify({title:"成功",message:"审核成功",type:"success",duration:2e3})}).catch(function(){e.$refs["refAudit"].loading=!1})})},cancel:function(t){var e=this;this.$confirm('是否确认作废名称为"'+t.name+'"的活动?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return Object(o["h"])({actId:t.sid,status:5})}).then(function(){e.$refs["refSearch"].search({current:e.searchData.page.current}),e.$message({showClose:!0,message:"作废成功",type:"success"})}).catch(function(){})},update:function(t){this.$router.push({path:"/market/promotion/creat",query:{id:t.sid}})},copy:function(t){var e=this;this.$confirm('是否复制名称为"'+t.name+'"的活动?',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){return Object(o["e"])({actId:t.sid})}).then(function(){e.$refs["refSearch"].search({current:e.searchData.page.current}),e.$message({showClose:!0,message:"复制成功",type:"success"})}).catch(function(){})}}},g=b,v=(a("183d"),Object(m["a"])(g,n,r,!1,null,"215e0df0",null));e["default"]=v.exports},d9ef:function(t,e,a){},e372:function(t,e,a){"use strict";var n=a("0cc7"),r=a.n(n);r.a}}]);