(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-33dc7a78"],{"3e88":function(e,t,a){},5193:function(e,t,a){"use strict";a.d(t,"d",function(){return n}),a.d(t,"h",function(){return s}),a.d(t,"f",function(){return o}),a.d(t,"e",function(){return l}),a.d(t,"i",function(){return c}),a.d(t,"j",function(){return d}),a.d(t,"b",function(){return u}),a.d(t,"k",function(){return m}),a.d(t,"l",function(){return p}),a.d(t,"g",function(){return h}),a.d(t,"a",function(){return f}),a.d(t,"c",function(){return v});var i=a("b775"),r=a("700d");function n(e){return Object(i["a"])({baseURL:r["a"],url:"/order/admin/order/page",method:"get",params:e})}function s(e){return Object(i["a"])({baseURL:r["a"],url:"/member/admin/userInfo",method:"get",params:e})}function o(e){return Object(i["a"])({baseURL:r["a"],url:"/admin/external/area/getAreaInfoByCode/".concat(e.areaCode),method:"get",params:e})}function l(e){return Object(i["a"])({baseURL:r["a"],url:"/member/admin/userInfo/account",method:"get",params:e})}function c(e){return Object(i["a"])({baseURL:r["a"],url:"/product/admin/product/pageByUserSid",method:"get",params:e})}function d(e){return Object(i["a"])({baseURL:r["a"],url:"/order/admin/order/shipping-info/".concat(e.userSid),method:"get",params:e})}function u(e){return Object(i["a"])({baseURL:r["a"],url:"/order/admin/order/create",method:"post",data:e})}function m(e){return Object(i["a"])({baseURL:r["a"],url:"/order/api/order/payment/captcha/".concat(e.orderId),method:"GET",params:e})}function p(e){return Object(i["a"])({baseURL:r["a"],url:"/order/api/order/payment/verify/".concat(e.orderId,"/").concat(e.captcha),method:"post",data:e})}function h(e){return Object(i["a"])({baseURL:r["a"],url:"/member/admin/userInfo/".concat(e.sid),method:"GET",params:e})}function f(e){return Object(i["a"])({baseURL:r["a"],url:"/order/api/order/".concat(e.orderId,"/").concat(e.orderStatus),method:"PUT",data:e})}function v(e){return Object(i["a"])({baseURL:r["a"],url:"/order/api/order/cashier//".concat(e.orderId),method:"POST"})}},"661b":function(e,t,a){"use strict";var i=a("d756"),r=a.n(i);r.a},"7d222":function(e,t,a){"use strict";var i=a("3e88"),r=a.n(i);r.a},aba4:function(e,t,a){"use strict";var i=a("b8fb"),r=a.n(i);r.a},b8fb:function(e,t,a){},c6a9:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container app-order-inner-creat"},[a("el-page-header",{attrs:{content:e.isDetail?"订单详情":"创建内部订单"},on:{back:e.goBack}}),e._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[e._v("基础信息")]),e._v(" "),a("div",{staticClass:"content-box"},[a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,size:"medium","inline-message":!0,"label-width":"0px"}},[a("div",{staticClass:"el-table el-table--fit el-table--border el-table--enable-row-hover el-table--enable-row-transition"},[a("table",{attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("tr",[a("td",{staticClass:"td-title"},[e._v("所属俱乐部")]),e._v(" "),a("td",{attrs:{colspan:"5"}},[e.isDetail?[e._v("\n                                "+e._s(e.detail.clubDesc)+"\n                            ")]:[a("el-form-item",{attrs:{prop:"club"}},[a("el-radio-group",{on:{change:e.changeClub},model:{value:e.form.club,callback:function(t){e.$set(e.form,"club",t)},expression:"form.club"}},e._l(e.userInfo.clubSet,function(t){return a("el-radio",{key:t,attrs:{label:t,name:"club"}},[e._v(e._s(1===t?"乐赛仙":2===t?"佐安堂":"初心"))])}),1)],1)]],2)]),e._v(" "),a("tr",[a("td",{staticClass:"td-title",attrs:{width:"140"}},[e._v("选择客户")]),e._v(" "),a("td",{staticClass:"search-member-bar",attrs:{colspan:"5"}},[e.isDetail?[e._v("\n                                "+e._s(e.detail.businessName)+"\n                            ")]:[a("el-form-item",{attrs:{prop:"userSid"}},[a("el-select",{staticClass:"search-type-select",attrs:{size:"small"},model:{value:e.memberQuick.searchType,callback:function(t){e.$set(e.memberQuick,"searchType",t)},expression:"memberQuick.searchType"}},e._l(e.membnerQuickList,function(t,i){return a("el-option",e._b({key:i},"el-option",t,!1))}),1),e._v(" "),a("el-select",{staticClass:"search-type-keyword",attrs:{size:"small",filterable:"",remote:"","reserve-keyword":"","value-key":"sid",placeholder:"请输入单位名称搜索","remote-method":e.fetchMemberList,loading:e.loading},on:{change:e.changeMember},model:{value:e.form.userSid,callback:function(t){e.$set(e.form,"userSid",t)},expression:"form.userSid"}},e._l(e.memberData,function(e){return a("el-option",{key:e.sid,attrs:{value:e,label:e.businessName}})}),1)],1),e._v(" "),a("el-checkbox",{staticStyle:{"padding-top":"5px"},attrs:{"true-label":!0,"false-label":!1},model:{value:e.isNewMemer,callback:function(t){e.isNewMemer=t},expression:"isNewMemer"}},[e._v("是否新客户")])]],2)]),e._v(" "),e.isDetail?e._e():a("tr",[a("td",{staticClass:"td-title"},[e._v("收货人")]),e._v(" "),a("td",[e._v(e._s(e.memberDetail.contactor))]),e._v(" "),a("td",{staticClass:"td-title"},[e._v("联系电话")]),e._v(" "),a("td",[e._v(e._s(e.memberDetail.contactorPhone))]),e._v(" "),a("td",{attrs:{colspan:"2"}})]),e._v(" "),a("tr",[a("td",{staticClass:"td-title",attrs:{width:"140"}},[e._v("区总")]),e._v(" "),a("td",{attrs:{width:"300"}},[e.isDetail?[e._v("\n                                "+e._s(e.detail.regionManagerName)+"\n                            ")]:[e._v("\n                                "+e._s(e.bossLevel1.username)+"\n                            ")]],2),e._v(" "),a("td",{staticClass:"td-title",attrs:{width:"140"}},[e._v("省总")]),e._v(" "),a("td",{attrs:{width:"300"}},[e.isDetail?[e._v("\n                                "+e._s(e.detail.provinceManagerName)+"\n                            ")]:[e._v("\n                                "+e._s(e.bossLevel2.username)+"\n                            ")]],2),e._v(" "),a("td",{staticClass:"td-title",attrs:{width:"140"}},[e._v("地总")]),e._v(" "),a("td",{attrs:{width:"300"}},[e.isDetail?[e._v("\n                                "+e._s(e.detail.districtManagerName)+"\n                            ")]:[e._v("\n                                "+e._s(e.bossLevel3.username||e.bossLevel2.username)+"\n                            ")]],2)]),e._v(" "),a("tr",[a("td",{staticClass:"td-title",attrs:{width:"140"}},[e._v("配送地址")]),e._v(" "),a("td",{attrs:{colspan:"5"}},[e.isDetail?[e._v("\n                                "+e._s(e.detail.shipAddress)+"\n                            ")]:[e._v("\n                                "+e._s(e.memberDetail.address)+"\n                            ")]],2)]),e._v(" "),a("tr",[a("td",{staticClass:"td-title",attrs:{width:"140"}},[e._v("物流方式")]),e._v(" "),a("td",{attrs:{colspan:"5"}},[e.isDetail?[e._v("\n                                "+e._s(e.detail.shippingName)+"\n                            ")]:[e.isNewMemer?[e._v("\n                                    韵达代收\n                                ")]:[a("el-form-item",{attrs:{prop:"shippingSid"}},[a("el-radio-group",{model:{value:e.form.shippingSid,callback:function(t){e.$set(e.form,"shippingSid",t)},expression:"form.shippingSid"}},e._l(e.shippingData,function(t){return a("el-radio",{key:t.sid,attrs:{label:t.sid,name:"club"}},[e._v(e._s(t.shippingName))])}),1)],1)]]],2)]),e._v(" "),a("tr",[a("td",{staticClass:"td-title",attrs:{width:"140"}},[e._v("发票类型")]),e._v(" "),a("td",[e.isDetail?[e._v("\n                                "+e._s(e.detail.invoiceShapeDesc)+"\n                            ")]:[a("el-form-item",{attrs:{prop:"invoiceShape"}},[a("el-radio-group",{model:{value:e.form.invoiceShape,callback:function(t){e.$set(e.form,"invoiceShape",t)},expression:"form.invoiceShape"}},[a("el-radio",{attrs:{label:1,name:"invoiceShape"}},[e._v("纸质发票")]),e._v(" "),a("el-radio",{attrs:{label:3,name:"invoiceShape"}},[e._v("电子普票")])],1)],1)]],2),e._v(" "),a("td",{staticClass:"td-title",attrs:{width:"140"}},[e._v(e._s(1===e.form.invoiceShape?"选择类型":"邮箱地址"))]),e._v(" "),a("td",{attrs:{colspan:"3"}},[1===e.form.invoiceShape?[e.isDetail?[e._v("\n                                    "+e._s(e.detail.invoiceTypeDesc)+"\n                                ")]:[a("el-form-item",{attrs:{prop:"invoiceType"}},[a("el-radio-group",{model:{value:e.form.invoiceType,callback:function(t){e.$set(e.form,"invoiceType",t)},expression:"form.invoiceType"}},[a("el-radio",{attrs:{label:1,name:"invoiceType",disabled:1===e.memberDetail.isGeneral}},[e._v("增值税普通发票")]),e._v(" "),a("el-radio",{attrs:{label:2,name:"invoiceType",disabled:0===e.memberDetail.isGeneral}},[e._v("增值税专用发票")])],1)],1)]]:[a("el-form-item",{attrs:{prop:"email"}},[a("el-input",{attrs:{size:"small"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)]],2)]),e._v(" "),a("tr",[a("td",{staticClass:"td-title",attrs:{width:"140"}},[e._v(e._s(e.isDetail?"用余额":"普通余额"))]),e._v(" "),a("td",[e.isDetail?[e._v("\n                                -￥"+e._s(e.detail.receivedAmount)+"\n                            ")]:[e._v("\n                                ￥"+e._s(e.accountInfo.balance)+"\n                            ")]],2),e._v(" "),a("td",{staticClass:"td-title",attrs:{width:"140"}},[e._v(e._s(e.isDetail?"用专项":"专项余额"))]),e._v(" "),a("td",[e.isDetail?[e._v("\n                                -￥"+e._s(e.detail.specialAmount)+"\n                            ")]:[e._v("\n                                ￥"+e._s(e.accountInfo.special)+"\n                            ")]],2),e._v(" "),a("td",{staticClass:"td-title",attrs:{width:"140"}},[e._v(e._s(e.isDetail?"用返利":"返利余额"))]),e._v(" "),a("td",[e.isDetail?[e._v("\n                                -￥"+e._s(e.detail.rebateAmount)+"\n                            ")]:[e._v("\n                                ￥"+e._s(e.accountInfo.rebate)+"\n                            ")]],2)])])])])],1),e._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[e._v("商品列表")]),e._v(" "),a("div",{staticClass:"content-box"},[e.isDetail?e._e():a("div",{staticClass:"search-bar"},[a("span",[e._v("查询药品：")]),e._v(" "),a("el-select",{staticClass:"search-type-select",attrs:{size:"small"},model:{value:e.searchQuick.searchType,callback:function(t){e.$set(e.searchQuick,"searchType",t)},expression:"searchQuick.searchType"}},e._l(e.quickList,function(t,i){return a("el-option",e._b({key:i},"el-option",t,!1))}),1),e._v(" "),a("el-select",{ref:"refSearchTypeKeyword",staticClass:"search-type-keyword",attrs:{filterable:"",remote:"","reserve-keyword":"","value-key":"sid",placeholder:"请输入关键词，按↑↓键选择商品，按回车键可添加商品","remote-method":e.fetchProduct,loading:e.fetchProductLoading,size:"small"},on:{change:e.changeProduct},model:{value:e.currentProduct,callback:function(t){e.currentProduct=t},expression:"currentProduct"}},e._l(e.productData,function(t){return a("el-option",{key:t.sid,attrs:{label:t.commodityName,value:t}},[a("div",{staticClass:"select-porduct-prop-li"},[a("span",{staticClass:"fl",attrs:{title:t.commodityName}},[e._v(e._s(t.commodityName))]),e._v(" "),a("span",{staticClass:"fr",attrs:{title:t.spec}},[e._v(e._s(t.spec))])])])}),1),e._v(" "),a("span",{staticClass:"right-count"},[e._v("\n                已选 "),a("el-tag",{attrs:{type:"danger",effect:"dark",size:"small"}},[e._v(e._s(e.selectedProductData.length))]),e._v(" 件商品\n            ")],1)],1),e._v(" "),a("div",{staticClass:"app-table"},[e.isDetail?[a("el-table",{attrs:{data:e.detail.generalItems,height:500}},[a("el-table-column",{attrs:{prop:"productCode",label:"商品编码","min-width":"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productName",label:"商品名称","min-width":"180","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"productSpec",label:"规格","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"manufacturer",label:"生产企业","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"price",label:"含税单价"}}),e._v(" "),a("el-table-column",{attrs:{prop:"quantity",label:"数量","min-width":"140"}}),e._v(" "),a("el-table-column",{attrs:{prop:"amount",label:"价税合计"}})],1),e._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[e._v("赠品列表")]),e._v(" "),a("div",{staticClass:"app-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.detail.giftList,height:400,"tooltip-effect":"light",stripe:""}},[a("el-table-column",{attrs:{prop:"giftName",label:"商品名称","min-width":"150",align:"left","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"giftSpec",label:"规格型号","min-width":"150",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"giftBrand",label:"品牌","min-width":"150",align:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"promotionTips",label:"促销活动","min-width":"200",align:"left","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"quantity",label:"数量","min-width":"150",align:"left","show-overflow-tooltip":""}})],1)],1),e._v(" "),a("div",{staticClass:"total-box"},[a("p",[a("span",[e._v("总金额：￥"+e._s(e.detail.totalAmount))])]),e._v(" "),a("p",[a("span",[e._v("应支付：￥"+e._s(e.detail.paymentAmount))])])])]:[a("el-table",{attrs:{data:e.selectedProductData,height:500}},[a("el-table-column",{attrs:{type:"index",width:"50",label:"序号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productCode",label:"商品编码","min-width":"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"commodityName",label:"商品名称","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"spec",label:"规格","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"unit",label:"单位","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"manufacturer",label:"生产企业","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"price",label:"含税单价"}}),e._v(" "),a("el-table-column",{attrs:{prop:"stock",label:"可用库存"}}),e._v(" "),a("el-table-column",{attrs:{label:"数量","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{attrs:{size:"mini",min:1,max:t.row.stock<t.row.maxNum?t.row.stock:t.row.maxNum,step:t.row.step},model:{value:t.row.quantity,callback:function(a){e.$set(t.row,"quantity",a)},expression:"scope.row.quantity"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"productCode",label:"价税合计"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s((t.row.quantity*t.row.price).toFixed(2))+"\n                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.selectedProductData.splice(t.$index,1)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{staticClass:"total-box"},[a("p",[a("span",[e._v("订单金额：￥"+e._s(e.totalMoeny.toFixed(2)))])])])]],2)]),e._v(" "),a("div",{staticClass:"footer-btn-box"},[e.isDetail?[e.overtime?a("span",{staticClass:"tips"},[e._v("订单已超时")]):e._e(),e._v(" "),1===e.detail.orderStatus?a("el-button",{attrs:{disabled:e.overtime,type:"primary"},on:{click:e.toPay}},[e._v("去付款")]):e._e()]:[a("el-button",{attrs:{loading:e.submiting,type:"primary"},on:{click:e.submitOrder}},[e._v("提交订单")])],e._v(" "),a("el-button",{on:{click:e.goBack}},[e._v("返回列表")])],2),e._v(" "),a("win-to-pay",{ref:"refToPay"}),e._v(" "),a("win-select-gift",{ref:"refGift"})],1)},r=[],n=(a("ac6a"),a("5193")),s=a("c719"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-win-order-inner-creat-topay",attrs:{title:"支付订单",visible:e.show,"close-on-click-modal":!1},on:{"update:visible":function(t){e.show=t}}},[e.timeEnd?[a("div",{staticClass:"tips-timeover"},[a("i",{staticClass:"el-icon-warning"}),e._v(" "),a("p",[e._v("订单已超时，请重新下单！")])])]:[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingCashier,expression:"loadingCashier"}],staticStyle:{width:"100%","min-height":"200px"}},[e.loadingCashier?e._e():a("div",[0===e.cashierDetail.paymentAmount||2===e.cashierDetail.invoiceType&&e.cashierDetail.availableReceivedBalance>=e.cashierDetail.paymentAmount?a("div",{staticClass:"account-pay"},[a("p",[e._v("\n                        请在\n                        "),a("span",{staticStyle:{color:"#f56c6c"}},[a("timer",{attrs:{"end-time":e.cashierDetail.expireTime,pay:1},on:{timeover:e.timeover}})],1),e._v("\n                        内完成支付，否则订单会自动取消。\n                    ")]),e._v(" "),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,size:"medium","label-width":"110px"}},[a("el-form-item",{attrs:{label:"验证码"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:6,placeholder:"请输入验证码"},model:{value:e.form.captcha,callback:function(t){e.$set(e.form,"captcha",t)},expression:"form.captcha"}},[a("el-button",{attrs:{slot:"append",loading:e.codeBtn.loading,disabled:e.codeBtn.disabled},on:{click:e.sendCode},slot:"append"},[e._v(e._s(e.codeBtn.text))])],1)],1)],1)],1):a("div",{staticClass:"qrcode-pay"},[2!==e.cashierDetail.invoiceType?[a("h2",[e._v("支付二维码")]),e._v(" "),a("p",[e._v("\n                            请在\n                            "),a("span",{staticStyle:{color:"#f56c6c"}},[a("timer",{attrs:{"end-time":e.cashierDetail.expireTime,pay:1},on:{timeover:e.timeover}})],1),e._v("\n                            内完成支付，否则订单会自动取消。\n                        ")]),e._v(" "),a("p",[e._v("客户余额不足，请扫描下方二维码，使用支付宝或者微信完成订单支付")]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:!e.aliInit,expression:"!aliInit"}],staticClass:"image-box"},[e.aliInit?a("vue-qrcode",{attrs:{value:e.aliPay.payUrl,options:{width:300}}}):e._e()],1)]:[a("div",{staticClass:"tips"},[a("p",[e._v("\n                                请在\n                                "),a("span",{staticStyle:{color:"#f56c6c"}},[a("timer",{attrs:{"end-time":e.cashierDetail.expireTime,pay:1},on:{timeover:e.timeover}})],1),e._v("\n                                内完成支付，否则订单会自动取消。\n                            ")]),e._v("\n                            剩余支付金额需线下公对公打款完成后,在内部订单列表点击详情，进入订单详情页完成支付。\n                        ")])]],2)])]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.show=!1}}},[e._v("取 消")]),e._v(" "),0===e.cashierDetail.paymentAmount||2===e.cashierDetail.invoiceType&&e.cashierDetail.availableReceivedBalance>=e.cashierDetail.paymentAmount?a("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.verifyCode}},[e._v("确认支付")]):e._e()],1)]],2)},l=[],c=a("d56f"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",[e._v(e._s(e.timerStr))])},u=[],m=a("5118"),p={name:"DateTimer",props:["endTime","pay"],data:function(){return{timerStr:"",timerFn:""}},created:function(){this.start()},beforeDestroy:function(){Object(m["clearInterval"])(this.timerFn)},methods:{timer:function(){var e=new Date(this.endTime).getTime(),t=(new Date).getTime(),a=e-t;if(a<=0)Object(m["clearInterval"])(this.timerFn),this.timerStr="0天0小时0分钟0秒",this.$emit("timeover");else{var i=1e3,r=60*i,n=60*r,s=24*n,o=parseInt(a/s),l=parseInt((a-o*s)/n),c=parseInt((a-(o*s+l*n))/r),d=parseInt((a-(o*s+l*n+c*r))/i);o=o<10?"0"+o:o,l=l<10?"0"+l:l,c=c<10?"0"+c:c,d=d<10?"0"+d:d,this.timerStr="".concat(o,"天").concat(l,"小时").concat(c,"分钟").concat(d,"秒")}},start:function(){var e=this;this.timer(),this.timerFn=Object(m["setInterval"])(function(){e.timer()},1e3)}}},h=p,f=a("2877"),v=Object(f["a"])(h,d,u,!1,null,null,null),b=v.exports,_={name:"WinOrderInnerCreatTopay",components:{VueQrcode:c["a"],timer:b},data:function(){return{edit:!1,loading:!1,form:{captcha:""},rules:{captcha:[{required:!0,message:"请输入短信验证码",trigger:"blur"}]},detail:{},aliPay:{},aliInit:!1,codeBtn:{loading:!1,disabled:!1,text:"发送验证码"},cashierDetail:{},timeEnd:!1,loadingCashier:!1,show:!1}},created:function(){},methods:{open:function(e,t){var a=this;this.edit=!0,this.loading=!1,this.callback=t,this.detail=e,this.show=!0,this.$nextTick(function(){a.fetchCashier(function(){a.detail.paymentAmount>0&&2!==a.detail.invoiceType&&a.toPay()})})},fetchCashier:function(e){var t=this;this.loadingCashier=!0,Object(n["c"])({orderId:this.detail.orderId}).then(function(a){var i=a.data.data;t.cashierDetail=i,t.loadingCashier=!1,e()}).catch(function(){t.loadingCashier=!1})},sendCode:function(){var e=this;this.$refs["ruleForm"].validate(function(t){t&&(e.codeBtn.loading=!0,e.countDown(),Object(n["k"])({orderId:e.detail.orderId}).then(function(t){t.data;e.countDown(),e.codeBtn.loading=!1}).catch(function(){e.codeBtn.loading=!1}))})},countDown:function(){var e=this,t=60;function a(){if(0===t)return e.codeBtn.disabled=!1,e.codeBtn.text="发送验证码",void(t=60);e.codeBtn.text="重新发送("+t+")",t--,e.timer=setTimeout(function(){a()},1e3)}e.codeBtn.disabled=!0,e.codeBtn.loading=!1,a()},verifyCode:function(){var e=this;this.$refs["ruleForm"].validate(function(t){if(!t)return!1;e.loading=!0,Object(n["l"])({orderId:e.detail.orderId,captcha:e.form.captcha}).then(function(t){t.data;e.loading=!1,e.callback(),e.$notify({title:"支付成功",message:"订单支付成功",type:"success",duration:2e3})}).catch(function(){e.loading=!1})})},toPay:function(){var e=this;Object(s["b"])({orderId:this.detail.orderId,paymentType:2}).then(function(t){var a=t.data.data;e.$set(e,"aliPay",a),e.aliInit=!0})},timeover:function(){this.timeEnd=!0},close:function(){this.show=!1}}},g=_,y=(a("aba4"),Object(f["a"])(g,o,l,!1,null,null,null)),w=y.exports,D=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-win-order-inner-select-gift",attrs:{title:"促销赠品选择",visible:e.show,"close-on-click-modal":!1},on:{"update:visible":function(t){e.show=t}}},[e._l(e.promotions,function(t){return a("div",{key:t.promotionId,staticClass:"market-box clearfix"},[a("p",[e._v(e._s(t.promotionTips))]),e._v(" "),a("el-table",{attrs:{data:t.giftList}},[a("el-table-column",{attrs:{label:"选择"},scopedSlots:e._u([{key:"default",fn:function(i){return[a("el-checkbox",{on:{change:function(a){return e.selection(t,i.row)}},model:{value:i.row.checked,callback:function(t){e.$set(i.row,"checked",t)},expression:"scope.row.checked"}})]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"商品编码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"giftName",label:"商品名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"giftSpec",label:"商品规格"}}),e._v(" "),a("el-table-column",{attrs:{label:"单位"}}),e._v(" "),a("el-table-column",{attrs:{prop:"quantity",label:"数量"}}),e._v(" "),a("el-table-column",{attrs:{label:"生产企业"}})],1)],1)}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.show=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.save}},[e._v("提交")])],1)],2)},k=[],C={name:"WinOrderInnerCreatSelectGift",components:{},data:function(){return{edit:!1,loading:!1,promotions:[],show:!1}},created:function(){},methods:{open:function(e,t){var a=this;this.edit=!0,this.loading=!1,this.callback=t,this.promotions=e,this.promotions.forEach(function(e){e.giftList.forEach(function(t,i){a.$set(t,"checked",i<e.giftOption)})}),this.show=!0,this.$nextTick(function(){})},selection:function(e,t){var a=e.giftList.filter(function(e){return!0===e.checked});a.length>e.giftOption&&(this.$message({message:"当前活动只能选择"+e.giftOption+"个赠品",type:"warning"}),t.checked=!1)},save:function(){var e=[];this.promotions.forEach(function(t){var a=t.giftList.filter(function(e){return!0===e.checked});e=e.concat(a)}),console.log("gifts",e),this.callback(e)},close:function(){this.show=!1}}},S=C,I=(a("7d222"),Object(f["a"])(S,D,k,!1,null,null,null)),T=I.exports,x={name:"PageInnerOrderCreat",components:{WinToPay:w,WinSelectGift:T},data:function(){return{isDetail:!1,orderId:this.$route.query.id,userInfo:this.$store.getters.userInfo,isNewMemer:!1,detail:{},quickList:[{label:"按商品名/助记码/通用名",value:"keyword"}],searchQuick:{searchType:"keyword",searchValue:""},memberQuick:{searchType:"businessName",searchValue:""},membnerQuickList:[{label:"按单位名称",value:"businessName"},{label:"按助记码",value:"zjm"},{label:"按会员编号",value:"userCode"},{label:"按手机号码",value:"phone"}],form:{club:this.$store.getters.userInfo.clubSet?this.$store.getters.userInfo.clubSet[0]:[],userSid:"",shippingSid:"",invoiceShape:1,invoiceType:""},rules:{userSid:[{required:!0,message:"请选择客户",trigger:"change"}],shippingSid:[],invoiceType:[{required:!0,message:"请选择发票类型",trigger:"change"}]},accountInfo:{balance:0,special:0,rebate:0},memberData:[],memberDetail:{},bossLevel1:{},bossLevel2:{},bossLevel3:{},shippingData:[],currentProduct:{},productData:[],fetchProductLoading:!1,selectedProductData:[],overtime:!1,submiting:!1}},computed:{totalMoeny:function(){var e=0;return this.selectedProductData.forEach(function(t){e=1*e+1*(t.quantity*t.price).toFixed(2)}),1*e}},created:function(){this.orderId&&(this.isDetail=!0,this.$set(this.$route.meta,"title","订单详情"),this.getOrderDetail())},mounted:function(){},methods:{goBack:function(){this.$store.dispatch("tagsView/delView",this.$route),this.$router.push("/order/inner")},fetchMemberList:function(e){var t=this,a={club:this.form.club,size:5,current:1};e&&(a[this.memberQuick.searchType]=e),Object(n["h"])(a).then(function(e){var a=e.data.data.records;t.memberData=a||[]})},changeClub:function(){this.form.userSid="",this.memberDetail={},this.bossLevel1={},this.bossLevel2={},this.bossLevel3={},this.memberData=[],this.shippingData=[],this.form.shippingSid="",this.productData=[],this.selectedProductData=[],this.accountInfo.balance=0,this.accountInfo.special=0,this.accountInfo.rebate=0},changeMember:function(e){this.memberDetail=e,this.bossLevel1={},this.bossLevel2={},this.bossLevel3={},this.shippingData=[],this.form.shippingSid="",this.productData=[],this.selectedProductData=[],this.fetchMemberDetail(),this.fetchMemberInfo(),this.fetchMemberAccount(),this.fetchShippingInfo()},fetchMemberInfo:function(){var e=this;Object(n["g"])({sid:this.memberDetail.sid}).then(function(t){var a=t.data.data;e.memberDetail.isGeneral=a.isGeneral,1===a.isGeneral?e.form.invoiceType=2:e.form.invoiceType=1,e.memberDetail.address=a.address,e.memberDetail.contactor=a.contactor,e.memberDetail.contactorPhone=a.contactorPhone,e.memberDetail.supplyErpCode=a.supplyErpCode})},fetchMemberDetail:function(){var e=this;Object(n["f"])({areaCode:this.memberDetail.areaSid,club:this.form.club}).then(function(t){var a=t.data.data;a.forEach(function(t){switch(t.specType){case 1:e.bossLevel1=t;break;case 2:e.bossLevel2=t;break;case 3:e.bossLevel3=t;break}})})},fetchMemberAccount:function(){var e=this;this.accountInfo.balance=0,this.accountInfo.special=0,this.accountInfo.rebate=0,Object(n["e"])({sid:this.memberDetail.sid,club:this.form.club}).then(function(t){var a=t.data.data;a.forEach(function(t){switch(t.type){case 0:e.accountInfo.balance=t.balance;break;case 2:e.accountInfo.special=t.balance;break;case 1:e.accountInfo.rebate=t.balance;break}})})},fetchShippingInfo:function(){var e=this;Object(n["j"])({userSid:this.memberDetail.sid}).then(function(t){var a=t.data.data;e.shippingData=a||[],e.shippingData.length>0&&(e.form.shippingSid=e.shippingData[0].sid)})},fetchProduct:function(e){var t=this;if(this.memberDetail.sid){this.fetchProductLoading=!0;var a={userSid:this.memberDetail.sid,club:this.form.club,current:1,size:10};e&&(a[this.searchQuick.searchType]=e),Object(n["i"])(a).then(function(e){var a=e.data.data.records;t.productData=a||[],t.fetchProductLoading=!1})}else this.$message({type:"warning",message:"请先选择客户"})},changeProduct:function(e){var t=this;e&&(this.selectedProductData.filter(function(t){return t.sid===e.sid}).length<1&&(this.$set(e,"quantity",1),this.selectedProductData.unshift(e)),this.currentProduct={},this.productData=[],this.$nextTick(function(){t.$refs["refSearchTypeKeyword"].focus()}))},formatOrderParams:function(){var e=[];this.selectedProductData.forEach(function(t){e.push({id:t.sid,quantity:t.quantity,price:t.price})});var t={useRebate:!1,orderList:[{userMessage:"",userSid:this.memberDetail.sid,club:this.form.club,invoiceType:this.form.invoiceType,source:"1",invoiceShape:this.form.invoiceShape,shippingSid:this.isNewMemer?11:this.form.shippingSid?1*this.form.shippingSid:null,generalProductList:e,supplierId:this.memberDetail.supplyErpCode,userName:this.memberDetail.businessName}]};return t},submitOrder:function(){var e=this;this.$refs["ruleForm"].validate(function(t){t&&(e.selectedProductData.length>0?(e.submiting=!0,Object(n["b"])(e.formatOrderParams()).then(function(t){var a=t.data.data;"string"!==typeof a&&a.length>0?e.$refs["refGift"].open(a,function(t){e.$refs["refGift"].loading=!0;var a=e.formatOrderParams();a.orderList[0].giftList=t,Object(n["b"])(a).then(function(t){var a=t.data.data;e.$refs["refGift"].close(),e.$notify({title:"成功",message:"订单创建成功",type:"success",duration:2e3}),e.$router.push({path:"/order/inner/creat",query:{id:a}})}).catch(function(){e.$refs["refGift"].loading=!1})}):(e.$notify({title:"成功",message:"订单创建成功",type:"success",duration:2e3}),e.$router.push({path:"/order/inner/creat",query:{id:a}}))}).catch(function(t){e.submiting=!1})):e.$message({type:"warning",message:"请添加商品"}))})},getOrderDetail:function(){var e=this;Object(s["a"])({orderId:this.orderId}).then(function(t){var a=t.data.data;if(e.detail=a,1===e.detail.orderStatus){var i=new Date(e.detail.expireTime).getTime(),r=(new Date).getTime(),n=i-r;n<=0&&(e.overtime=!0)}})},toPay:function(){var e=this;this.$refs["refToPay"].open(this.detail,function(){e.$refs["refToPay"].close(),e.getOrderDetail()})}}},O=x,$=(a("661b"),Object(f["a"])(O,i,r,!1,null,null,null));t["default"]=$.exports},c719:function(e,t,a){"use strict";a.d(t,"a",function(){return n}),a.d(t,"b",function(){return s});var i=a("b775"),r=a("700d");function n(e){return Object(i["a"])({baseURL:r["a"],url:"/order/admin/order/orderDetailByOrderId",method:"get",params:e})}function s(e){return Object(i["a"])({baseURL:r["a"],url:"/order/api/order/payment/".concat(e.orderId,"/").concat(e.paymentType),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",source:1}})}},d756:function(e,t,a){}}]);